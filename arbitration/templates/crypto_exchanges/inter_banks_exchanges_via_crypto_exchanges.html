{% extends 'base.html' %}

{% block title %}
  Inter-bank exchanges through crypto-exchanges
{% endblock %}

{% block content %}
{% load custom_filters %}
  <ul class="nav nav-tabs">
    <li class="nav-item dropdown active">
    <a class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Input banks</a>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item dropdown-item {% if request.path|last_url_path:3 == 'input_banks' %}active{% endif %}" href="/{{ request.path|last_url_path:4 }}/input_banks/{{ request.path|last_url_path:2 }}/{{ request.path|last_url_path:1 }}/">All banks</a></li>
      <li><hr class="dropdown-divider"></li>
      {% for bank_name in bank_names %}
        <li><a class="dropdown-item {% if request.path|last_url_path:3 == bank_name %}active{% endif %}" href="{% if request.path|last_url_path:2 == bank_name %}/{{ request.path|last_url_path:4 }}/{{ bank_name }}/intra_banks_exchanges_via_crypto_exchanges/{% else %}/{{ request.path|last_url_path:4 }}/{{ bank_name }}/{{ request.path|last_url_path:2 }}/{{ request.path|last_url_path:1 }}/{% endif %}">{{ bank_name }}</a></li>
      {% endfor %}
    </ul>
  </li>
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Output banks</a>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item {% if request.path|last_url_path:2 == 'output_banks' %}active{% endif %}" href="/{{ request.path|last_url_path:4 }}/{{ request.path|last_url_path:3 }}/output_banks/{{ request.path|last_url_path:1 }}/">All banks</a></li>
      <li><hr class="dropdown-divider"></li>
      {% for bank_name in bank_names %}
        <li><a class="dropdown-item {% if request.path|last_url_path:2 == bank_name %}active{% endif %}" href="{% if request.path|last_url_path:3 == bank_name %}/{{ request.path|last_url_path:4 }}/{{ bank_name }}/intra_banks_exchanges_via_crypto_exchanges/{% else %}/{{ request.path|last_url_path:4 }}/{{ request.path|last_url_path:3 }}/{{ bank_name }}/{{ request.path|last_url_path:1 }}/{% endif %}">{{ bank_name }}</a></li>
      {% endfor %}
    </ul>
  </li>
    <li class="ms-auto nav-item">
      <a class="nav-link {% if request.path|last_url_path:4 == 'crypto_exchanges' %}active{% endif %}" href="/crypto_exchanges/{{ request.path|last_url_path:3 }}/{{ request.path|last_url_path:2 }}/{{ request.path|last_url_path:1 }}/">All crypto exchanges</a>
    </li>
    {% for crypto_exchange_name in crypto_exchange_names %}
      <li class="nav-item">
        <a class="nav-link {% if crypto_exchange_name == request.path|last_url_path:4 %}active{% endif %}" href="/{{ crypto_exchange_name }}/{{ request.path|last_url_path:3 }}/{{ request.path|last_url_path:2 }}/{{ request.path|last_url_path:1 }}/">{{ crypto_exchange_name }}</a>
      </li>
    {% endfor %}
  </ul>

  <h1>
    The best possible Inter-bank exchanges through crypto-exchanges
  </h1>
  <p>
    Count rates: {{ crypto_exchange_rates.count }}
  </p>
  <p>
    Last update: {{ last_update }}
  </p>
  <table class="table table-striped table-dark">
    <thead>
      <tr>
        <th scope="col">#</th>
        {% if request.path|last_url_path:4 == 'crypto_exchanges' %}<th scope="col">Crypto exchange</th>{% endif %}
        {% if request.path|last_url_path:3 == 'input_banks' %}<th scope="col">From bank</th>{% endif %}
        {% if request.path|last_url_path:2 == 'output_banks' %}<th scope="col">To bank</th>{% endif %}
        <th scope="col">Currencies</th>
        <th scope="col">Payment channels</th>
        <th scope="col">Price</th>
        <th scope="col">Updated</th>
      </tr>
    </thead>
    {% for crypto_exchange_rate in crypto_exchange_rates %}
      <tr>
        <th scope="row">{{ forloop.counter }}</th>
        {% if request.path|last_url_path:4 == 'crypto_exchanges' %}<td>{{ crypto_exchange_rate.crypto_exchange.name }}</td>{% endif %}
        {% if request.path|last_url_path:3 == 'input_banks' %}<td>{{ crypto_exchange_rate.input_bank.name }}</td>{% endif %}
        {% if request.path|last_url_path:2 == 'output_banks' %}<td>{{ crypto_exchange_rate.output_bank.name }}</td>{% endif %}
        <td>
          {{ crypto_exchange_rate.from_fiat }} ->
          {% if crypto_exchange_rate.input_exchange.payment_channel == 'Card2Wallet2CryptoExchanges' %}
            {{ crypto_exchange_rate.from_fiat }} -> { crypto_exchange_rate.input_exchange.asset }} ->
          {% else %}
            {{ crypto_exchange_rate.input_exchange.asset }} ->
          {% endif %}
          {% if crypto_exchange_rate.interim_exchange is not None %}
            {{ crypto_exchange_rate.interim_exchange.to_asset }} ->
          {% endif %}
          {% if crypto_exchange_rate.output_exchange.payment_channel == 'Card2Wallet2CryptoExchanges' %}
            {{ crypto_exchange_rate.to_fiat }} ->
          {% endif %}
          {{ crypto_exchange_rate.to_fiat }}
        </td>
        <td>
          {{ crypto_exchange_rate.input_exchange.payment_channel_model|payment_channel_name:'BUY' }} ->
          {% if crypto_exchange_rate.interim_exchange is not None %}
          Internal ->
          {% endif %}
          {{ crypto_exchange_rate.output_exchange.payment_channel_model|payment_channel_name:'SELL' }}
        </td>
        <td>{{ crypto_exchange_rate.price|round_up }}</td>
        <td>{{ crypto_exchange_rate.update.updated}}</td>
      </tr>
    {% endfor %}
  </table>
{% endblock %}