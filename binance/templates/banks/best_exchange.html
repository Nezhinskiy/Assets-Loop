{% extends 'base.html' %}

{% block title %}
  Best ways for bank exchange
{% endblock %}

{% block content %}
{% load custom_filters %}
{% include 'banks/includes/bank_selector.html' %}
  <h1>
    Best ways for bank exchange
  </h1>
  <p>
    Count rates: {{ bank_rates.count }}
  </p>
  <p>
    Last update: {{ last_update }}
  </p>
  <table class="table table-striped table-dark">
  <thead>
    <tr>
      <th scope="col">#</th>
      {% if request.path|last_url_path:2 == 'banks' %}<th scope="col">Bank</th>{% endif %}
      <th scope="col">Way</th>
      <th scope="col">Currencies</th>
      <th scope="col">Price</th>
      <th scope="col">Updated</th>
    </tr>
  </thead>
    {% for bank_rate in bank_rates %}
      {% with bank_rate|get_related_exchange as true_bank_rate %}
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          {% if request.path|last_url_path:2 == 'banks' %}<td>{{ bank_rate.bank.name }}</td>{% endif %}
          <td>
            {% if bank_rate.bank_exchange_model == 'BanksExchangeRates' %}
              Intrabank exchange
            {% elif bank_rate.bank_exchange_model == 'BankInvestExchanges' %}
              {{ true_bank_rate.currency_market.name }}
            {% elif bank_rate.bank_exchange_model == 'IntraBanksNotLoopedExchanges' %}
              Intrabank triple exchange
            {% endif %}
          </td>
          <td>
            {% if bank_rate.bank_exchange_model == 'IntraBanksNotLoopedExchanges' %}
              {% for currency in true_bank_rate.list_of_transfers %}
                {{ currency }}
                {% if not forloop.last %}->{% endif %}
              {% endfor %}
            {% else %}
              {{ bank_rate.from_fiat }} -> {{ bank_rate.to_fiat }}
            {% endif %}
          </td>
          <td>{{ true_bank_rate.price }}</td>
          <td>{{ true_bank_rate.update.updated}}</td>
        </tr>
      {% endwith %}
    {% endfor %}
  </table>
{% endblock %}