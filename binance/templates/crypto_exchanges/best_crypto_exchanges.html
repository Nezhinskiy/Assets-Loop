{% extends 'base.html' %}

{% block title %}
  The best ways to deposit and withdrawal
{% endblock %}

{% block content %}
{% load custom_filters %}
{% include 'crypto_exchanges/includes/bank_and_crypto_exchange_selector.html' %}
  <h1>
    The best ways to deposit and withdrawal
  </h1>
  <p>
    Count rates: {{ crypto_exchange_rates.count }}
  </p>
  <p>
    Last update: {{ last_update }}
  </p>
  <table class="table table-striped table-dark">
    <thead>
      <tr>
        <th scope="col">#</th>
        {% if request.path|last_url_path:3 == 'crypto_exchanges' %}<th scope="col">Crypto exchange</th>{% endif %}
        {% if request.path|last_url_path:2 == 'banks' %}<th scope="col">Bank</th>{% endif %}
        <th scope="col">Trade type</th>
        <th scope="col">Currencies</th>
        <th scope="col">Price</th>
        <th scope="col">Payment channel</th>
        <th scope="col">Updated</th>
      </tr>
    </thead>
    {% for crypto_exchange_rate in crypto_exchange_rates %}
      {% with crypto_exchange_rate|get_related_exchange as true_crypto_exchange_rate %}
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          {% if request.path|last_url_path:3 == 'crypto_exchanges' %}<td>{{ crypto_exchange_rate.crypto_exchange.name }}</td>{% endif %}
          {% if request.path|last_url_path:2 == 'banks' %}<td>{{ crypto_exchange_rate.bank.name }}</td>{% endif %}
          {% if crypto_exchange_rate.trade_type == 'SELL' %}<td>Withdrawal{% else %}<td>Deposit</td>{% endif %}
          {% if crypto_exchange_rate.trade_type == 'SELL' %}
            {% if crypto_exchange_rate.payment_channel_model == 'Card2Wallet2CryptoExchanges' %}
              <td>{{ crypto_exchange_rate.asset }} -> {{ crypto_exchange_rate.fiat }} -> {{ crypto_exchange_rate.fiat }}</td>
            {% else %}
              <td>{{ crypto_exchange_rate.asset }} -> {{ crypto_exchange_rate.fiat }}</td>
            {% endif %}
          {% else %}
            {% if crypto_exchange_rate.payment_channel_model == 'Card2Wallet2CryptoExchanges' %}
              <td>{{ crypto_exchange_rate.fiat }} -> {{ crypto_exchange_rate.fiat }} -> {{ crypto_exchange_rate.asset }}</td>
            {% else %}
              <td>{{ crypto_exchange_rate.fiat }} -> {{ crypto_exchange_rate.asset }}</td>
            {% endif %}
          {% endif %}
          <td>{{ true_crypto_exchange_rate.price|round_up }}</td>
          <td>{{ crypto_exchange_rate.payment_channel_model|payment_channel_name:crypto_exchange_rate.trade_type }}</td>
          <td>{{ crypto_exchange_rate.update.updated }}</td>
        </tr>
      {% endwith %}
    {% endfor %}
  </table>
{% endblock %}